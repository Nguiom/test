---
// InteractivePyramid.astro

interface PyramidLevel {
  id: number;
  name: string;
  description: string;
  color: string;
  examples: string[];
}
---

<div 
  x-data="pyramidData()" 
  x-init="init()"
  class="pyramid-container"
  client:load
>
  <!-- Pyramid Image with Clickable Areas -->
  <div class="relative w-full max-w-4xl mx-auto">
    <!-- SVG Pyramid with clickable levels -->
    <svg 
      viewBox="0 0 800 600" 
      class="w-full h-auto cursor-pointer"
      @click="handlePyramidClick($event)"
    >
      <!-- Level 5 - Business Planning & Logistics -->
      <polygon
        id="level5"
        points="400,50 600,150 200,150"
        class="fill-blue-300 hover:fill-blue-400 stroke-2 stroke-blue-600 transition-colors duration-200"
        :class="{ 'fill-blue-500': activeLevel === 5 }"
        data-level="5"
      />
      <text x="400" y="100" text-anchor="middle" class="text-lg font-bold fill-blue-900 pointer-events-none">
        Level 5
      </text>
      <text x="400" y="125" text-anchor="middle" class="text-sm fill-blue-900 pointer-events-none">
        Enterprise
      </text>

      <!-- Level 4 - Business Planning & Logistics -->
      <polygon
        id="level4"
        points="200,150 600,150 550,250 250,250"
        class="fill-green-300 hover:fill-green-400 stroke-2 stroke-green-600 transition-colors duration-200"
        :class="{ 'fill-green-500': activeLevel === 4 }"
        data-level="4"
      />
      <text x="400" y="200" text-anchor="middle" class="text-lg font-bold fill-green-900 pointer-events-none">
        Level 4
      </text>
      <text x="400" y="225" text-anchor="middle" class="text-sm fill-green-900 pointer-events-none">
        Business Planning
      </text>

      <!-- Level 3 - Manufacturing Operations -->
      <polygon
        id="level3"
        points="250,250 550,250 500,350 300,350"
        class="fill-yellow-300 hover:fill-yellow-400 stroke-2 stroke-yellow-600 transition-colors duration-200"
        :class="{ 'fill-yellow-500': activeLevel === 3 }"
        data-level="3"
      />
      <text x="400" y="300" text-anchor="middle" class="text-lg font-bold fill-yellow-900 pointer-events-none">
        Level 3
      </text>
      <text x="400" y="325" text-anchor="middle" class="text-sm fill-yellow-900 pointer-events-none">
        Manufacturing Operations
      </text>

      <!-- Level 2 - Supervisory Control -->
      <polygon
        id="level2"
        points="300,350 500,350 450,450 350,450"
        class="fill-orange-300 hover:fill-orange-400 stroke-2 stroke-orange-600 transition-colors duration-200"
        :class="{ 'fill-orange-500': activeLevel === 2 }"
        data-level="2"
      />
      <text x="400" y="400" text-anchor="middle" class="text-lg font-bold fill-orange-900 pointer-events-none">
        Level 2
      </text>
      <text x="400" y="425" text-anchor="middle" class="text-sm fill-orange-900 pointer-events-none">
        Supervisory Control
      </text>

      <!-- Level 1 - Field/Control -->
      <polygon
        id="level1"
        points="350,450 450,450 400,550"
        class="fill-red-300 hover:fill-red-400 stroke-2 stroke-red-600 transition-colors duration-200"
        :class="{ 'fill-red-500': activeLevel === 1 }"
        data-level="1"
      />
      <text x="400" y="500" text-anchor="middle" class="text-lg font-bold fill-red-900 pointer-events-none">
        Level 1
      </text>
      <text x="400" y="525" text-anchor="middle" class="text-sm fill-red-900 pointer-events-none">
        Field/Control
      </text>

      <!-- Level 0 - Process -->
      <polygon
        id="level0"
        points="400,550 450,450 350,450"
        class="fill-purple-300 hover:fill-purple-400 stroke-2 stroke-purple-600 transition-colors duration-200"
        :class="{ 'fill-purple-500': activeLevel === 0 }"
        data-level="0"
      />
      <text x="400" y="575" text-anchor="middle" class="text-lg font-bold fill-purple-900 pointer-events-none">
        Level 0
      </text>
      <text x="400" y="600" text-anchor="middle" class="text-sm fill-purple-900 pointer-events-none">
        Process
      </text>
    </svg>
  </div>

  <!-- Flashcards Container -->
  <div 
    x-show="activeLevel !== null"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 transform scale-95"
    x-transition:enter-end="opacity-100 transform scale-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 transform scale-100"
    x-transition:leave-end="opacity-0 transform scale-95"
    class="mt-8 max-w-2xl mx-auto"
  >
    <div class="bg-white rounded-xl shadow-2xl p-6 border-2" :class="getLevelColor(activeLevel)">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h3 class="text-2xl font-bold" x-text="getLevelName(activeLevel)"></h3>
          <p class="text-gray-600" x-text="getLevelDescription(activeLevel)"></p>
        </div>
        <button 
          @click="activeLevel = null"
          class="text-gray-500 hover:text-gray-700 text-2xl"
          aria-label="Close flashcard"
        >
          &times;
        </button>
      </div>

      <div class="mb-6">
        <h4 class="font-semibold text-lg mb-2">Examples:</h4>
        <ul class="list-disc pl-5 space-y-1">
          <template x-for="example in getLevelExamples(activeLevel)" :key="example">
            <li x-text="example"></li>
          </template>
        </ul>
      </div>

      <div class="flex justify-between pt-4 border-t">
        <button
          @click="previousLevel()"
          :disabled="activeLevel <= 0"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          :class="{ 'hidden': activeLevel <= 0 }"
        >
          ← Previous Level
        </button>
        
        <div class="flex space-x-2">
          <template x-for="level in [0,1,2,3,4,5]" :key="level">
            <button
              @click="activeLevel = level"
              class="w-8 h-8 rounded-full border-2"
              :class="[
                activeLevel === level ? 'scale-125 border-white ring-2 ring-offset-2' : '',
                getLevelColor(level).replace('border-', 'bg-')
              ]"
              :aria-label="`Go to level ${level}`"
              x-text="level"
            ></button>
          </template>
        </div>

        <button
          @click="nextLevel()"
          :disabled="activeLevel >= 5"
          class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          :class="{ 'hidden': activeLevel >= 5 }"
        >
          Next Level →
        </button>
      </div>
    </div>
  </div>

  <!-- Level Selection Buttons (for mobile/alternative navigation) -->
  <div class="mt-6 flex flex-wrap justify-center gap-2">
    <template x-for="level in levels" :key="level.id">
      <button
        @click="activeLevel = level.id"
        class="px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-105 active:scale-95"
        :class="[
          activeLevel === level.id 
            ? 'text-white shadow-lg scale-105' 
            : 'text-gray-800 hover:shadow',
          level.color.replace('fill-', 'bg-')
        ]"
        x-text="`Level ${level.id}: ${level.name}`"
      ></button>
    </template>
  </div>
</div>
